const e={name:"rminder",version:1,storeNames:["tasks"]};const t={my_day:"My day",important:"Important"};function s(){console.log("openDb ...");const t=indexedDB.open(e.name,e.version);t.onsuccess=()=>{e.db=t.result;console.log("openDb DONE");a();postMessage({type:"opened",message:"DB opened"});i()};t.onerror=e=>{console.error("openDb:",e.target.error)};t.onblocked=e=>{console.error("openDb: Please close all other tabs with the App open",e.target.error)};t.onupgradeneeded=()=>{console.log("openDb.onupgradeneeded");e.db=t.result;const s=e.db.createObjectStore(e.storeNames[0],{keyPath:"id",autoIncrement:true});s.createIndex("title","title",{unique:false});s.createIndex("important","important",{unique:false});s.createIndex("my_day","my_day",{unique:false});s.createIndex("completed","completed",{unique:false});s.createIndex("note","note",{unique:false});s.createIndex("creation_date","creation_date",{unique:false});a()}}function a(){e.db.onversionchange=t=>{e.db.close();console.log("openDb: A new version of this page is ready. Please reload or close this tab!",t)}}function o(t,s){return e.db.transaction(t,s).objectStore(t)}function n(t,s,a){const n={title:t,creation_date:s};const r=o(e.storeNames[0],"readwrite");let c;try{if(a==="my_day"){n.my_day=true}if(a==="important"){n.important=true}c=r.add(n)}catch(e){if(e.name=="DataCloneError"){postMessage({type:"failure",message:"This engine doesn't know how to clone a Blob, use Firefox"})}throw e}c.onsuccess=()=>{postMessage({type:"success",message:"addTask: successful"});i(r,a)};c.onerror=()=>{postMessage({type:"failure",message:`addTask: error -> ${c.error}`})}}function r(t){const s=o(e.storeNames[0],"readwrite");s.openCursor().onsuccess=e=>{const a=e.target.result;if(a){if(a.value.id===t){const e=a.delete();e.onsuccess=()=>{postMessage({type:"success",message:`Task(${t}): deleted`});postMessage({type:"hideDetails"})}}a.continue()}else{i(s)}}}function c(t){const s=o(e.storeNames[0],"readonly");s.openCursor().onsuccess=e=>{const s=e.target.result;if(s){if(s.value.id===t){postMessage({type:"details",key:s.key,value:s.value})}s.continue()}}}function d(t,s,a){const n=o(e.storeNames[0],"readwrite");n.openCursor().onsuccess=e=>{const o=e.target.result;if(o){const e=!a||o.value[s]!==a;if(o.value.id===t&&e){const e=o.value;e[s]=a||!e[s];const n=o.update(e);n.onsuccess=()=>{postMessage({type:"success",message:`Task(${t}): ${s} = ${e[s]}`})}}o.continue()}else{i(n)}}}function i(s,a){if(typeof s=="undefined"){s=o(e.storeNames[0],"readonly")}postMessage({type:"clear",message:"Clear"});s.getAll().onsuccess=e=>{let s=e.target.result;if(a!=="tasks"){s=s.filter((e=>e[a]));postMessage({type:"tasks",value:e.target.result,list:{title:t[a],name:a,value:s}})}else{postMessage({type:"tasks",value:e.target.result})}}}onmessage=e=>{const{type:t}=e.data;switch(t){case"addTask":n(e.data.title,e.data.creationDate,e.data.list);break;case"removeTask":r(e.data.id);break;case"renameTask":d(e.data.id,"title",e.data.title);break;case"showDetails":c(e.data.id);break;case"importantTask":d(e.data.id,"important");break;case"myDayTask":d(e.data.id,"my_day");break;case"noteTask":d(e.data.id,"note",e.data.note);break;case"completedTask":d(e.data.id,"completed");break;case"display":case"list":i(undefined,e.data.list);break;default:postMessage({type:t});break}};s();